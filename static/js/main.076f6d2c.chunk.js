(this["webpackJsonpfeature-lint-editor"]=this["webpackJsonpfeature-lint-editor"]||[]).push([[0],{50:function(e,t,n){"use strict";n.r(t);var i,r,o=n(1),u=n.n(o),c=n(17),a=n.n(c),l=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,52)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,o=t.getLCP,u=t.getTTFB;n(e),i(e),r(e),o(e),u(e)}))},s=n(9),d=n(12),f=n(10),b=n(13),g=n.n(b),p=n(14),j=n(7),h=n.n(j),x=n(3),O=n(5),y=n(16),v="urn:building-block-figure:",B=h()("BuildingBlockFigureId",x.d().refine((function(e){return e.startsWith(v)}))),k=B.create,w=h()("BuildingBlockFigure",x.c({id:B,bbName:x.d(),type:x.a("BuildingBlockFigure"),x:x.b().positive(),y:x.b().positive(),width:x.b().positive(),height:x.b().positive()})),m=w.create,C=h()("RuleTool",x.c({type:x.a("PLACE_RULE"),from:w.nullable(),to:w.nullable()})),T=C.create,E=h()("Visual-Selection",x.c({type:x.a("SELECTION")})),F=h()("Visual-BB",x.c({type:x.a("PLACE_BUILDING_BLOCK")})),L=h()("Visual-Feature",x.c({type:x.a("PLACE_FEATURE")})),S=h()("Tool",x.e([E,F,L,C])),I=(F.create,E.create,S.create),R=f.a.button(i||(i=Object(s.a)(["\n  padding: 8px;\n  font-size: 12px;\n  outline: none;\n  border: 0;\n  display: flex;\n  width: 100%;\n  flex-direction: column;\n  align-items: center;\n  background: ",";\n  &:hover {\n    background: ",";\n    cursor: pointer;\n  }\n"])),(function(e){return e.active?"#f6f6f6":"transparent"}),(function(e){return e.active?"#f6f6f6":"#ececec"})),N=n(2),D=1.1,P=function(e){var t=e.tool,n=e.selectTool;return Object(N.jsxs)(A,{children:[Object(N.jsxs)(R,{active:"SELECTION"===t.currentTool.type,onClick:function(){return n(I({type:"SELECTION"}))},children:[Object(N.jsx)(g.a,{path:p.b,size:D,color:"grey"}),"Select"]}),Object(N.jsxs)(R,{active:"PLACE_FEATURE"===t.currentTool.type,onClick:function(){return n(I({type:"PLACE_FEATURE"}))},children:[Object(N.jsx)(g.a,{path:p.c,size:D,color:"grey"}),"Feature"]}),Object(N.jsxs)(R,{active:"PLACE_BUILDING_BLOCK"===t.currentTool.type,onClick:function(){return n(I({type:"PLACE_BUILDING_BLOCK"}))},children:[Object(N.jsx)(g.a,{path:p.d,size:D,color:"grey"}),"Building Block"]}),Object(N.jsxs)(R,{active:"PLACE_RULE"===t.currentTool.type,onClick:function(){return n(I({type:"PLACE_RULE",from:null,to:null}))},children:[Object(N.jsx)(g.a,{path:p.e,size:D,color:"grey"}),"Rule"]})]})},A=f.a.div(r||(r=Object(s.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: centeR;\n  justify-content: flex-start;\n  left: 8px;\n  top: 30%;\n  position: absolute;\n  width: 64px;\n  background: white;\n  z-index: 99999;\n  border-radius: 5px;\n\n  -webkit-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  -moz-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n"]))),z=n(6),U=n(8);var _,G,W,K,q,J=h()("RuleGhost",x.c({endX:x.b(),endY:x.b()})).create,M=function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();return(null===n||void 0===n?void 0:n.x)&&n.y?n:{x:0,y:0}},H=function(e){var t=e.target.position();if((null===t||void 0===t?void 0:t.x)&&t.y)return t;throw new Error("No element pos possible")},V=n(24),X=function(e){var t=e.figure,n=e.updateFeatureType,i=Object(o.useState)(!1),r=Object(U.a)(i,2),u=r[0],c=r[1],a=Object(o.useState)({}),l=Object(U.a)(a,2),s=l[0],d=l[1],f=Object(o.useRef)(),b=t.height,g=t.width;return Object(N.jsxs)(z.b,{draggable:!0,onDragMove:function(e){var i=H(e);n.updatePosition(t,i.x,i.y)},children:[u?Object(N.jsx)(V.a,{children:Object(N.jsx)("textarea",{onKeyDown:function(e){13===e.keyCode&&c(!1)},onChange:function(e){n.updateName(t,e.target.value)},ref:function(e){return null===e||void 0===e?void 0:e.focus()},style:Object(O.a)(Object(O.a)({background:"red",position:"absolute"},s),{},{height:b+"px"}),children:t.name})}):null,Object(N.jsx)(z.f,{ref:f,preventDefault:!0,listening:!1,fill:"black",wrap:"none",align:"center",verticalAlign:"middle",width:200,height:50,text:t.name,x:t.x,y:t.y,fontSize:20}),Object(N.jsx)(z.d,{onDblClick:function(e){c(!u);var t=f.current.getAbsolutePosition(),n=e.currentTarget.getStage().container().getBoundingClientRect(),i=n.left+t.x,r=n.top+t.y;d({top:r+"px",left:i+"px",width:g+"px"})},draggable:!0,x:t.x,y:t.y,height:b,width:g,strokeWidth:5,stroke:"black"})]})},Y=function(e){var t=e.figure,n=e.onSelect,i=e.updateBuildingBlock,r=Object(o.useState)(!1),u=Object(U.a)(r,2),c=u[0],a=u[1],l=Object(o.useState)({}),s=Object(U.a)(l,2),d=s[0],f=s[1],b=Object(o.useRef)(),g=t.width,p=t.height,j=p/20,h=c?"green":"red";return Object(N.jsxs)(z.b,{draggable:!0,onDragEnd:function(e){var n=H(e);i.updatePosition(t,n.x,n.y)},onDragMove:function(e){var n=H(e);i.updatePosition(t,n.x,n.y)},onClick:function(e){n(t)},children:[c?Object(N.jsx)(V.a,{children:Object(N.jsx)("textarea",{onKeyDown:function(e){13===e.keyCode&&a(!1)},onChange:function(e){i.updateName(t,e.target.value)},ref:function(e){return null===e||void 0===e?void 0:e.focus()},style:Object(O.a)(Object(O.a)({background:"red",position:"absolute"},d),{},{height:p+"px"}),children:t.bbName})}):null,Object(N.jsx)(z.d,{onDblClick:function(e){a(!c);var t=b.current.getAbsolutePosition(),n=e.currentTarget.getStage().container().getBoundingClientRect(),i=n.left+t.x,r=n.top+t.y;f({top:r+"px",left:i+"px",width:g+"px"})},draggable:!0,x:t.x,y:t.y,width:g,height:p,stroke:h}),Object(N.jsx)(z.f,{preventDefault:!0,ref:b,listening:!1,fill:h,wrap:"none",align:"center",verticalAlign:"middle",width:g,height:p,text:t.bbName,x:t.x,y:t.y+j/2,fontSize:20})]})},$="urn:feature-type:",Q=h()("FeatureTypeFigureId",x.d().refine((function(e){return e.startsWith($)}))),Z=Q.create,ee=h()("FeatureRep",x.c({id:Q,name:x.d(),type:x.a("FeatureFigure"),x:x.b().positive(),y:x.b().positive(),width:x.b().positive(),height:x.b().positive()})).create,te=function(e){var t=e.queryBuildingBlocks,n=e.rule,i=t.buildingBlockById(k(n.from)),r=t.buildingBlockById(k(n.to));return r&&i?Object(N.jsx)(z.a,{onClick:function(){return console.log("HELLO")},points:[i.x,i.y,r.x,r.y],stroke:"red",strokeWidth:5}):null},ne=function(e){var t,n,i,r=e.figures,u=e.tool,c=e.updateBuildingBlock,a=e.selectRule,l=e.queryBuildingBlocks,s=e.updateFeatureType,d=function(){var e=Object(o.useState)({width:window.innerWidth,height:window.innerHeight}),t=Object(U.a)(e,2),n=t[0],i=t[1];return Object(o.useEffect)((function(){function e(){i({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),f=u.currentTool;return Object(N.jsx)(re,{children:Object(N.jsxs)(z.e,{height:d.height,width:d.width,onMouseMove:function(e){var t=M(e);u.setRuleGhost((function(e){return J({endX:t.x,endY:t.y})}))},onClick:function(t){var n=M(t);console.log("CLICK ON"),ie(e,{x:n.x,y:n.y})},children:[Object(N.jsx)(z.c,{children:Object(N.jsx)(z.d,{listening:!1,x:0,y:0,width:d.width,height:d.height,fill:"#fbfbfb"})}),Object(N.jsxs)(z.c,{children:[r.featureTypeFigures.map((function(e){return Object(N.jsx)(X,{figure:e,updateFeatureType:s},e.id)})),r.buildingBlockFigures.map((function(e){return Object(N.jsx)(Y,{updateBuildingBlock:c,figure:e,onSelect:a},e.id)})),(i=f,"PLACE_RULE"===i.type&&null!==i.from&&u.ruleGhost?Object(N.jsx)(z.a,{listening:!1,points:[f.from.x,f.from.y,null===(t=u.ruleGhost)||void 0===t?void 0:t.endX,null===(n=u.ruleGhost)||void 0===n?void 0:n.endY],strokeWidth:2,stroke:"red"}):null),r.rules.map((function(e){return Object(N.jsx)(te,{queryBuildingBlocks:l,rule:e},e.id)}))]})]})})},ie=function(e,t){var n=e.tool,i=e.placeFeature,r=e.placeBuildingBlock;switch(n.currentTool.type){case"PLACE_FEATURE":i(ee({name:"unnamed-feature",id:Z($+Object(y.a)()),height:500,width:500,x:t.x,y:t.y,type:"FeatureFigure"}));break;case"PLACE_BUILDING_BLOCK":r(t.x,t.y)}},re=f.a.div(_||(_=Object(s.a)(["\n  cursor: crosshair;\n"]))),oe=n(51),ue=function(e,t){var n=e.onBuildingBlocks;return{updateName:function(e,i){var r=t.findIndex((function(t){return t.id===e.id}));if(-1===r)return t;var o=oe.a(r,(function(e){return function(e,t){return m(Object(O.a)(Object(O.a)({},t),{},{bbName:e}))}(i,e)}),t);return n(o),o},updatePosition:function(e,i,r){var o=t.findIndex((function(t){return t.id===e.id}));if(-1===o)return t;var u=oe.a(o,(function(e){return function(e,t,n){return m(Object(O.a)(Object(O.a)({},n),{},{x:e,y:t}))}(i,r,e)}),t);return n(u),u}}},ce="urn:dependency-rule:",ae=h()("DependencyRuleFigureId",x.d().refine((function(e){return e.startsWith(ce)}))),le=(ae.create,h()("DependencyRuleFigure",x.c({id:ae,from:B,to:B})).create),se=function(e){var t=e.buildingBlockId,n=e.query,i=e.onClose,r=n.buildingBlockById(t);return r?Object(N.jsxs)(fe,{children:[Object(N.jsx)(de,{children:Object(N.jsx)("h2",{children:"Details"})}),Object(N.jsx)("h2",{children:r.bbName}),r.id,Object(N.jsx)("button",{onClick:i,children:"Close"})]}):null},de=f.a.div(G||(G=Object(s.a)(["\n  padding: 8px;\n"]))),fe=f.a.div(W||(W=Object(s.a)(["\n  display: flex;\n  background: red;\n  flex-direction: column;\n  align-items: flex-star;\n  justify-content: flex-start;\n  right: 0;\n  top: 0;\n  height: 100%;\n  position: absolute;\n  width: 400px;\n  background: white;\n  z-index: 99999;\n  border-radius: 5px;\n\n  -webkit-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  -moz-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n"]))),be=n(4),ge=n(19),pe=function(e){return{top:e.y,bottom:e.y+e.height,left:e.x,right:e.x+e.width}},je=function(e){var t=e.convertToJson;return Object(N.jsxs)(he,{children:[Object(N.jsxs)(R,{active:!1,onClick:t,children:[Object(N.jsx)(g.a,{path:p.f,size:1.1,color:"grey"}),"Load"]}),Object(N.jsxs)(R,{active:!1,children:[Object(N.jsx)(g.a,{path:p.a,size:1.1,color:"grey"}),"Save"]})]})},he=f.a.div(K||(K=Object(s.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  margin: 0 auto;\n  left: 50%;\n  top: 0;\n  position: absolute;\n  height: 64px;\n  min-width: 200px;\n  background: white;\n  z-index: 99999;\n  border-radius: 5px;\n\n  -webkit-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  -moz-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n"]))),xe=function(e){var t=e.onFeatures,n=(0,e.featureTypes)();return{updateName:function(e,i){var r=n.findIndex((function(t){return t.id===e.id}));if(-1===r)return n;var o=oe.a(r,(function(e){return function(e,t){return ee(Object(O.a)(Object(O.a)({},t),{},{name:e}))}(i,e)}),n);return t(o),o},updatePosition:function(e,i,r){var o=n.findIndex((function(t){return t.id===e.id}));if(-1===o)return n;var u=oe.a(o,(function(e){return function(e,t,n){return ee(Object(O.a)(Object(O.a)({},n),{},{x:e,y:t}))}(i,r,e)}),n);return t(u),u}}},Oe=function(e){var t,n=function(){var e=Object(o.useState)([]),t=Object(U.a)(e,2),n=t[0],i=t[1],r=Object(o.useState)([]),u=Object(U.a)(r,2),c=u[0],a=u[1],l=Object(o.useState)([]),s=Object(U.a)(l,2);return{featureTypeFigures:n,setFeatureTypeFigures:i,buildingBlockFigures:c,setBuildingBlockFigures:a,rules:s[0],setRules:s[1]}}(),i=function(){var e=Object(o.useState)(I({type:"SELECTION"})),t=Object(U.a)(e,2),n=t[0],i=t[1],r=Object(o.useState)(null),u=Object(U.a)(r,2),c=u[0],a=u[1],l=Object(o.useState)(null),s=Object(U.a)(l,2);return{currentTool:n,setCurrentTool:i,ruleGhost:c,setRuleGhost:a,details:s[0],setDetails:s[1]}}(),r=function(e){var t=e.onBuildingBlocksUpdated,n=e.buildingBlocks;return function(e,i){var r=m({id:B.create(v+Object(y.a)()),type:"BuildingBlockFigure",width:100,height:50,x:e,y:i,bbName:"unamed"}),o=[].concat(Object(d.a)(n()),[r]);t(o)}}({onBuildingBlocksUpdated:function(e){n.setBuildingBlockFigures(e),i.setCurrentTool(I({type:"SELECTION"}))},buildingBlocks:function(){return n.buildingBlockFigures}}),u=function(e){var t=e.onRules,n=e.buildingBlocks,i=e.rules;return function(e,r){var o=n().find((function(t){return t.id===e.id})),u=n().find((function(e){return e.id===r.id}));if(o&&u){var c=[].concat(Object(d.a)(i()),[le({id:ce+Object(y.a)(),from:o.id,to:u.id})]);t(c)}}}({onRules:function(e){return n.setRules(e)},buildingBlocks:function(){return n.buildingBlockFigures},rules:function(){return n.rules}}),c=function(e){var t=e.tool,n=e.onDetails;return function(){"SELECTION"===t().type&&n(null)}}({tool:function(){return i.currentTool},onDetails:function(e){return i.setDetails(e?k(e.id):null)}}),a=function(e){var t=e.onToolUpdated,n=e.placeDependencyRule,i=e.tool,r=e.onSelectedBuildingBlock;return function(e){var o=i();if("SELECTION"!==o.type){if("PLACE_RULE"===o.type){if(null===T(o).from){var u=I(Object(O.a)(Object(O.a)({},o),{},{from:e}));t(u)}else{if(null===o.from)throw new Error("Invalid state");n(m(o.from),e),t(I({type:"SELECTION"}))}}}else r(e)}}({onToolUpdated:function(e){return i.setCurrentTool(e)},onSelectedBuildingBlock:function(e){return i.setDetails(k(e.id))},placeDependencyRule:u,tool:function(){return i.currentTool}}),l=(t=n.buildingBlockFigures,{buildingBlockById:function(e){return t.find((function(t){return t.id===e}))}}),s=ue({onBuildingBlocks:n.setBuildingBlockFigures},n.buildingBlockFigures),f=xe({onFeatures:function(e){return n.setFeatureTypeFigures(e)},featureTypes:function(){return n.featureTypeFigures}}),b=function(e){e.dependencyRules;var t=e.buildingBlocks,n=e.featureTypes,i=e.onConfig;return function(){var e,r,o,u={},c=Object(ge.a)(n());try{for(c.s();!(e=c.n()).done;){var a=e.value,l=pe(a);u[a.name]={};var s,d=Object(ge.a)(t());try{for(d.s();!(s=d.n()).done;){var f=s.value;r=pe(f),(o=l).left>r.right||o.right<r.left||o.top>r.bottom||o.bottom<r.top||(u[a.name]=Object(O.a)(Object(O.a)({},u[a.name]),{},Object(be.a)({},f.bbName,{})))}}catch(g){d.e(g)}finally{d.f()}}}catch(g){c.e(g)}finally{c.f()}var b={$schema:"https://raw.githubusercontent.com/feature-lint/feature-lint/pages/schema/feature-lint-v0.0.15.schema.json",rootDir:"./src/features",featureTypes:u};console.log(b),i(b)}}({buildingBlocks:function(){return n.buildingBlockFigures},dependencyRules:function(){return n.rules},featureTypes:function(){return n.featureTypeFigures},onConfig:function(e){return alert(JSON.stringify(e))}});return Object(N.jsxs)(ye,{children:[Object(N.jsx)(je,{convertToJson:b}),Object(N.jsx)(P,{tool:i,selectTool:function(e){return i.setCurrentTool(e)}}),Object(N.jsx)(ne,{updateBuildingBlock:s,updateFeatureType:f,queryBuildingBlocks:l,placeFeature:function(e){n.setFeatureTypeFigures((function(t){return[].concat(Object(d.a)(t),[e])})),i.setCurrentTool(I({type:"SELECTION"}))},placeBuildingBlock:r,selectRule:a,tool:i,figures:n}),i.details?Object(N.jsx)(se,{query:l,onClose:c,buildingBlockId:i.details}):null]})},ye=f.a.div(q||(q=Object(s.a)(["\n  width: 100%;\n  height: 100vh;\n  position: relative;\n"]))),ve=function(e){return Object(N.jsx)(Oe,{})};a.a.render(Object(N.jsx)(u.a.StrictMode,{children:Object(N.jsx)(ve,{})}),document.getElementById("root")),l()}},[[50,1,2]]]);
//# sourceMappingURL=main.076f6d2c.chunk.js.map