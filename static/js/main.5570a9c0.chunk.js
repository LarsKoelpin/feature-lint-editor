(this["webpackJsonpfeature-lint-editor"]=this["webpackJsonpfeature-lint-editor"]||[]).push([[0],{50:function(e,t,n){"use strict";n.r(t);var i,r,o=n(1),u=n.n(o),c=n(15),l=n.n(c),a=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,52)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,o=t.getLCP,u=t.getTTFB;n(e),i(e),r(e),o(e),u(e)}))},d=n(9),s=n(13),f=n(10),b=n(11),g=n.n(b),h=n(12),p=n(7),j=n.n(p),x=n(3),O=n(5),y=n(17),v="urn:building-block-figure:",B=j()("BuildingBlockFigureId",x.d().refine((function(e){return e.startsWith(v)}))),k=B.create,w=j()("BuildingBlockFigure",x.c({id:B,bbName:x.d(),type:x.a("BuildingBlockFigure"),x:x.b().positive(),y:x.b().positive(),width:x.b().positive(),height:x.b().positive()})),m=w.create,C=j()("RuleTool",x.c({type:x.a("PLACE_RULE"),from:w.nullable(),to:w.nullable()})),F=C.create,T=j()("Visual-Selection",x.c({type:x.a("SELECTION")})),E=j()("Visual-BB",x.c({type:x.a("PLACE_BUILDING_BLOCK")})),L=j()("Visual-Feature",x.c({type:x.a("PLACE_FEATURE")})),S=j()("Tool",x.e([T,E,L,C])),I=(E.create,T.create,S.create),R=f.a.button(i||(i=Object(d.a)(["\n  padding: 8px;\n  font-size: 12px;\n  outline: none;\n  border: 0;\n  display: flex;\n  width: 100%;\n  flex-direction: column;\n  align-items: center;\n  background: ",";\n  &:hover {\n    background: ",";\n    cursor: pointer;\n  }\n"])),(function(e){return e.active?"#f6f6f6":"transparent"}),(function(e){return e.active?"#f6f6f6":"#ececec"})),N=n(2),P=1.1,D=function(e){var t=e.tool,n=e.selectTool;return Object(N.jsxs)(A,{children:[Object(N.jsxs)(R,{active:"SELECTION"===t.currentTool.type,onClick:function(){return n(I({type:"SELECTION"}))},children:[Object(N.jsx)(g.a,{path:h.c,size:P,color:"grey"}),"Select"]}),Object(N.jsxs)(R,{active:"PLACE_FEATURE"===t.currentTool.type,onClick:function(){return n(I({type:"PLACE_FEATURE"}))},children:[Object(N.jsx)(g.a,{path:h.d,size:P,color:"grey"}),"Feature"]}),Object(N.jsxs)(R,{active:"PLACE_BUILDING_BLOCK"===t.currentTool.type,onClick:function(){return n(I({type:"PLACE_BUILDING_BLOCK"}))},children:[Object(N.jsx)(g.a,{path:h.e,size:P,color:"grey"}),"Building Block"]}),Object(N.jsxs)(R,{active:"PLACE_RULE"===t.currentTool.type,onClick:function(){return n(I({type:"PLACE_RULE",from:null,to:null}))},children:[Object(N.jsx)(g.a,{path:h.f,size:P,color:"grey"}),"Allow Import"]})]})},A=f.a.div(r||(r=Object(d.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: centeR;\n  justify-content: flex-start;\n  left: 8px;\n  top: 30%;\n  position: absolute;\n  width: 64px;\n  background: white;\n  z-index: 99999;\n  border-radius: 5px;\n\n  -webkit-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  -moz-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n"]))),z=n(6),U=n(8);var _,G,q,K,W,H,J,M=j()("RuleGhost",x.c({endX:x.b(),endY:x.b()})).create,V=function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();return(null===n||void 0===n?void 0:n.x)&&n.y?n:{x:0,y:0}},X=function(e){var t=e.target.position();if((null===t||void 0===t?void 0:t.x)&&t.y)return t;throw new Error("No element pos possible")},Y=n(19),$=function(e){var t=e.figure,n=e.updateFeatureType,i=e.onSelect,r=Object(o.useState)(!1),u=Object(U.a)(r,2),c=u[0],l=u[1],a=Object(o.useState)({}),d=Object(U.a)(a,2),s=d[0],f=d[1],b=Object(o.useRef)(),p=t.height,j=t.width;return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)(z.b,{draggable:!0,onDragMove:function(e){var i=X(e);n.updatePosition(t,i.x,i.y)},children:[c?Object(N.jsx)(Y.a,{children:Object(N.jsx)("textarea",{onKeyDown:function(e){13===e.keyCode&&l(!1)},onChange:function(e){n.updateName(t,e.target.value)},ref:function(e){return null===e||void 0===e?void 0:e.focus()},style:Object(O.a)(Object(O.a)({background:"red",position:"absolute"},s),{},{height:p+"px"}),children:t.name})}):null,Object(N.jsx)(z.f,{ref:b,preventDefault:!0,listening:!1,fill:"black",wrap:"none",align:"center",verticalAlign:"middle",width:200,height:50,text:t.name,x:t.x,y:t.y,fontSize:20}),Object(N.jsx)(z.d,{onDblClick:function(e){l(!c);var t=b.current.getAbsolutePosition(),n=e.currentTarget.getStage().container().getBoundingClientRect(),i=n.left+t.x,r=n.top+t.y;f({top:r+"px",left:i+"px",width:j+"px"})},draggable:!0,x:t.x,y:t.y,height:p,width:j,strokeWidth:5,stroke:"black"})]}),Object(N.jsx)(Y.a,{groupProps:{x:t.x+t.width-42,y:t.y,fill:"red",width:42,height:42},children:Object(N.jsx)("div",{style:{width:42,height:42,padding:"8px",boxSizing:"border-box"},onClick:function(){return i(t,"ICON")},children:Object(N.jsx)(g.a,{path:h.a,size:1.2})})})]})},Q=function(e){var t=e.figure,n=e.onSelect,i=e.updateBuildingBlock,r=Object(o.useState)(!1),u=Object(U.a)(r,2),c=u[0],l=u[1],a=Object(o.useState)({}),d=Object(U.a)(a,2),s=d[0],f=d[1],b=Object(o.useRef)(),p=t.width,j=t.height,x=j/20,y=c?"green":"red";return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)(z.b,{draggable:!0,onDragEnd:function(e){var n=X(e);i.updatePosition(t,n.x,n.y)},onDragMove:function(e){var n=X(e);i.updatePosition(t,n.x,n.y)},onClick:function(e){n(t,"BLOCK")},children:[c?Object(N.jsx)(Y.a,{children:Object(N.jsx)("textarea",{onKeyDown:function(e){13===e.keyCode&&l(!1)},onChange:function(e){i.updateName(t,e.target.value)},ref:function(e){return null===e||void 0===e?void 0:e.focus()},style:Object(O.a)(Object(O.a)({background:"red",position:"absolute"},s),{},{height:j+"px"}),children:t.bbName})}):null,Object(N.jsx)(z.d,{onDblClick:function(e){l(!c);var t=b.current.getAbsolutePosition(),n=e.currentTarget.getStage().container().getBoundingClientRect(),i=n.left+t.x,r=n.top+t.y;f({top:r+"px",left:i+"px",width:p+"px"})},draggable:!0,x:t.x,y:t.y,width:p,height:j,stroke:y}),Object(N.jsx)(z.f,{preventDefault:!0,ref:b,listening:!1,fill:y,wrap:"none",align:"center",verticalAlign:"middle",width:p,height:j,text:t.bbName,x:t.x,y:t.y+x/2,fontSize:20})]}),Object(N.jsx)(Y.a,{groupProps:{x:t.x+t.width-42,y:t.y,fill:"red",width:42,height:42},children:Object(N.jsx)("div",{style:{width:42,height:42,padding:"8px",boxSizing:"border-box"},onClick:function(){return n(t,"ICON")},children:Object(N.jsx)(g.a,{path:h.a,size:1.2})})})]})},Z="urn:feature-type:",ee=j()("FeatureTypeFigureId",x.d().refine((function(e){return e.startsWith(Z)}))),te=ee.create,ne=j()("FeatureRep",x.c({id:ee,name:x.d(),type:x.a("FeatureFigure"),x:x.b().positive(),y:x.b().positive(),width:x.b().positive(),height:x.b().positive()})).create,ie=function(e){var t=e.queryBuildingBlocks,n=e.rule,i=t.figureById(k(n.from)),r=t.figureById(k(n.to));return r&&i?Object(N.jsx)(z.a,{onClick:function(){return console.log("HELLO")},points:[i.x,i.y,r.x,r.y],stroke:"red",strokeWidth:5}):null},re=function(e){var t,n,i,r=e.figures,u=e.tool,c=e.updateBuildingBlock,l=e.onSelectFigure,a=e.queryBuildingBlocks,d=e.updateFeatureType,s=function(){var e=Object(o.useState)({width:window.innerWidth,height:window.innerHeight}),t=Object(U.a)(e,2),n=t[0],i=t[1];return Object(o.useEffect)((function(){function e(){i({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),f=u.currentTool;return Object(N.jsx)(ue,{children:Object(N.jsxs)(z.e,{height:s.height,width:s.width,onMouseMove:function(e){var t=V(e);u.setRuleGhost((function(e){return M({endX:t.x,endY:t.y})}))},onClick:function(t){var n=V(t);oe(e,{x:n.x,y:n.y})},children:[Object(N.jsx)(z.c,{children:Object(N.jsx)(z.d,{listening:!1,x:0,y:0,width:s.width,height:s.height,fill:"#fbfbfb"})}),Object(N.jsxs)(z.c,{children:[r.featureTypeFigures.map((function(e){return Object(N.jsx)($,{onSelect:l,figure:e,updateFeatureType:d},e.id)})),r.buildingBlockFigures.map((function(e){return Object(N.jsx)(Q,{updateBuildingBlock:c,figure:e,onSelect:l},e.id)})),(i=f,"PLACE_RULE"===i.type&&null!==i.from&&u.ruleGhost?Object(N.jsx)(z.a,{listening:!1,points:[f.from.x,f.from.y,null===(t=u.ruleGhost)||void 0===t?void 0:t.endX,null===(n=u.ruleGhost)||void 0===n?void 0:n.endY],strokeWidth:2,stroke:"red"}):null),r.rules.map((function(e){return Object(N.jsx)(ie,{queryBuildingBlocks:a,rule:e},e.id)}))]})]})})},oe=function(e,t){var n=e.tool,i=e.placeFeature,r=e.placeBuildingBlock;switch(n.currentTool.type){case"PLACE_FEATURE":i(ne({name:"unnamed-feature",id:te(Z+Object(y.a)()),height:500,width:500,x:t.x,y:t.y,type:"FeatureFigure"}));break;case"PLACE_BUILDING_BLOCK":r(t.x,t.y)}},ue=f.a.div(_||(_=Object(d.a)(["\n  cursor: crosshair;\n"]))),ce=n(51),le=function(e,t){var n=e.onBuildingBlocks;return{updateName:function(e,i){var r=t.findIndex((function(t){return t.id===e.id}));if(-1===r)return t;var o=ce.a(r,(function(e){return function(e,t){return m(Object(O.a)(Object(O.a)({},t),{},{bbName:e}))}(i,e)}),t);return n(o),o},updatePosition:function(e,i,r){var o=t.findIndex((function(t){return t.id===e.id}));if(-1===o)return t;var u=ce.a(o,(function(e){return function(e,t,n){return m(Object(O.a)(Object(O.a)({},n),{},{x:e,y:t}))}(i,r,e)}),t);return n(u),u}}},ae="urn:dependency-rule:",de=j()("DependencyRuleFigureId",x.d().refine((function(e){return e.startsWith(ae)}))),se=(de.create,j()("DependencyRuleFigure",x.c({id:de,from:B,to:B})).create),fe=function(e){return"BuildingBlockFigure"===(null===e||void 0===e?void 0:e.type)},be=function(e){var t=e.figure,n=e.onClose;return Object(N.jsxs)("div",{children:[Object(N.jsx)("h2",{children:t.bbName}),t.id,Object(N.jsx)("button",{onClick:n,children:"Close"})]})},ge=function(e){var t=e.figureId,n=e.query,i=e.onClose,r=n.figureById(t);return r?Object(N.jsxs)(pe,{children:[Object(N.jsx)(he,{children:Object(N.jsx)("h2",{children:"Details"})}),function(){switch(r.type){case"BuildingBlockFigure":return Object(N.jsx)(be,{figure:r,onClose:i});case"FeatureFigure":return Object(N.jsx)("div",{children:"Hello"})}}()]}):null},he=f.a.div(G||(G=Object(d.a)(["\n  padding: 8px;\n"]))),pe=f.a.div(q||(q=Object(d.a)(["\n  display: flex;\n  background: red;\n  flex-direction: column;\n  align-items: flex-star;\n  justify-content: flex-start;\n  right: 0;\n  top: 0;\n  height: 100%;\n  position: absolute;\n  width: 400px;\n  background: white;\n  z-index: 99999;\n  border-radius: 5px;\n\n  -webkit-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  -moz-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n"]))),je=n(4),xe=n(18),Oe=function(e){return{top:e.y,bottom:e.y+e.height,left:e.x,right:e.x+e.width}},ye=f.a.div(K||(K=Object(d.a)(["\n  position: fixed;\n  height: 100%;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0, 0, 0, 0.5);\n  top: 0;\n  left: 0;\n  z-index: 999999999999999999;\n"]))),ve=f.a.div(W||(W=Object(d.a)(["\n  width: 500px;\n  height: 500px;\n  background: white;\n"]))),Be=function(e){return l.a.createPortal(Object(N.jsx)(ye,{children:Object(N.jsx)(ve,{children:e.children})}),document.getElementById("portal"))},ke=function(e){var t=e.text,n=e.close;return Object(N.jsx)(Be,{children:Object(N.jsxs)("div",{style:{padding:"8px",height:"100%",display:"flex",flexDirection:"column"},children:[Object(N.jsx)("div",{children:Object(N.jsx)("h2",{children:"Configuration export"})}),Object(N.jsx)("div",{style:{width:"100%",height:"100%",border:"1px solid black",overflow:"scroll"},contentEditable:!0,children:t}),Object(N.jsx)("button",{onClick:function(){return n()},children:" Close"})]})})},we=function(e){var t=e.convertToJson,n=Object(o.useState)(""),i=Object(U.a)(n,2),r=i[0],u=i[1];return Object(N.jsxs)(me,{children:[r?Object(N.jsx)(ke,{text:r,close:function(){return u("")}}):null,Object(N.jsxs)(R,{active:!1,onClick:function(){u(JSON.stringify(t()))},children:[Object(N.jsx)(g.a,{path:h.b,size:1.1,color:"grey"}),"Save"]})]})},me=f.a.div(H||(H=Object(d.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  margin: 0 auto;\n  left: 50%;\n  top: 0;\n  position: absolute;\n  height: 64px;\n  min-width: 200px;\n  background: white;\n  z-index: 99999;\n  border-radius: 5px;\n\n  -webkit-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  -moz-box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n  box-shadow: rgba(0, 0, 0, 0.3) 0 1px 3px;\n"]))),Ce=function(e){var t=e.onFeatures,n=(0,e.featureTypes)();return{updateName:function(e,i){var r=n.findIndex((function(t){return t.id===e.id}));if(-1===r)return n;var o=ce.a(r,(function(e){return function(e,t){return ne(Object(O.a)(Object(O.a)({},t),{},{name:e}))}(i,e)}),n);return t(o),o},updatePosition:function(e,i,r){var o=n.findIndex((function(t){return t.id===e.id}));if(-1===o)return n;var u=ce.a(o,(function(e){return function(e,t,n){return ne(Object(O.a)(Object(O.a)({},n),{},{x:e,y:t}))}(i,r,e)}),n);return t(u),u}}},Fe=function(e){var t,n,i=function(){var e=Object(o.useState)([]),t=Object(U.a)(e,2),n=t[0],i=t[1],r=Object(o.useState)([]),u=Object(U.a)(r,2),c=u[0],l=u[1],a=Object(o.useState)([]),d=Object(U.a)(a,2);return{featureTypeFigures:n,setFeatureTypeFigures:i,buildingBlockFigures:c,setBuildingBlockFigures:l,rules:d[0],setRules:d[1]}}(),r=function(){var e=Object(o.useState)(I({type:"SELECTION"})),t=Object(U.a)(e,2),n=t[0],i=t[1],r=Object(o.useState)(null),u=Object(U.a)(r,2),c=u[0],l=u[1],a=Object(o.useState)(null),d=Object(U.a)(a,2);return{currentTool:n,setCurrentTool:i,ruleGhost:c,setRuleGhost:l,details:d[0],setDetails:d[1]}}(),u=function(e){var t=e.onBuildingBlocksUpdated,n=e.buildingBlocks;return function(e,i){var r=m({id:B.create(v+Object(y.a)()),type:"BuildingBlockFigure",width:150,height:75,x:e,y:i,bbName:"unamed"}),o=[].concat(Object(s.a)(n()),[r]);t(o)}}({onBuildingBlocksUpdated:function(e){i.setBuildingBlockFigures(e),r.setCurrentTool(I({type:"SELECTION"}))},buildingBlocks:function(){return i.buildingBlockFigures}}),c=function(e){var t=e.onRules,n=e.buildingBlocks,i=e.rules;return function(e,r){var o=n().find((function(t){return t.id===e.id})),u=n().find((function(e){return e.id===r.id}));if(o&&u){var c=[].concat(Object(s.a)(i()),[se({id:ae+Object(y.a)(),from:o.id,to:u.id})]);t(c)}}}({onRules:function(e){return i.setRules(e)},buildingBlocks:function(){return i.buildingBlockFigures},rules:function(){return i.rules}}),l=function(e){var t=e.tool,n=e.onDetails;return function(){"SELECTION"===t().type&&n(null)}}({tool:function(){return r.currentTool},onDetails:function(e){return r.setDetails((null===e||void 0===e?void 0:e.id)||null)}}),a=function(e){var t=e.onToolUpdated,n=e.placeDependencyRule,i=e.tool,r=e.onSelectedFigure;return function(e,o){var u=i();if("SELECTION"===u.type&&"BLOCK"!==o)return console.log("HI",e),void r(e);if("PLACE_RULE"===u.type)if(null===F(u).from&&null!==e&&fe(e)){var c=I(Object(O.a)(Object(O.a)({},u),{},{from:e}));t(c)}else{if(null===u.from||null===e||!fe(e))throw new Error("Invalid state. Second Place Rule does only work on Valid BBs, but was placed on "+e);n(m(u.from),e),t(I({type:"SELECTION"}))}}}({onToolUpdated:function(e){return r.setCurrentTool(e)},onSelectedFigure:function(e){return r.setDetails((null===e||void 0===e?void 0:e.id)||null)},placeDependencyRule:c,tool:function(){return r.currentTool}}),d=(t=i.buildingBlockFigures,n=i.featureTypeFigures,{figureById:function(e){var i=t.find((function(t){return t.id===e}));return i||n.find((function(t){return t.id===e}))||null}}),f=le({onBuildingBlocks:i.setBuildingBlockFigures},i.buildingBlockFigures),b=Ce({onFeatures:function(e){return i.setFeatureTypeFigures(e)},featureTypes:function(){return i.featureTypeFigures}}),g=function(e){var t=e.dependencyRules,n=e.buildingBlocks,i=e.featureTypes,r=e.query;return function(){var e,o,u,c={},l=Object(xe.a)(i());try{for(l.s();!(e=l.n()).done;){var a=e.value,d=Oe(a);c[a.name]={};var f,b=Object(xe.a)(n());try{for(b.s();!(f=b.n()).done;){var g=f.value;if(o=Oe(g),!((u=d).left>o.right||u.right<o.left||u.top>o.bottom||u.bottom<o.top)){var h,p=[],j=Object(xe.a)(t());try{for(j.s();!(h=j.n()).done;){var x=h.value,y=r.figureById(k(x.from)),v=r.figureById(k(x.to));if(!y||!v)throw new Error("Trying to create a dep rule from "+y+" to "+v+" but one of them is null");fe(v)&&(p=[].concat(Object(s.a)(p),["@"+v.bbName]))}}catch(B){j.e(B)}finally{j.f()}c[a.name]=Object(O.a)(Object(O.a)({},c[a.name]),{},Object(je.a)({},g.bbName,{rules:[{name:"dependencies",criteria:p}]}))}}}catch(B){b.e(B)}finally{b.f()}}}catch(B){l.e(B)}finally{l.f()}return{$schema:"https://raw.githubusercontent.com/feature-lint/feature-lint/pages/schema/feature-lint-v0.0.15.schema.json",rootDir:"./src/features",featureTypes:c}}}({query:d,buildingBlocks:function(){return i.buildingBlockFigures},dependencyRules:function(){return i.rules},featureTypes:function(){return i.featureTypeFigures}});return Object(N.jsxs)(Te,{children:[Object(N.jsx)(we,{convertToJson:g}),Object(N.jsx)(D,{tool:r,selectTool:function(e){return r.setCurrentTool(e)}}),Object(N.jsx)(re,{updateBuildingBlock:f,updateFeatureType:b,queryBuildingBlocks:d,placeFeature:function(e){i.setFeatureTypeFigures((function(t){return[].concat(Object(s.a)(t),[e])})),r.setCurrentTool(I({type:"SELECTION"}))},placeBuildingBlock:u,onSelectFigure:a,tool:r,figures:i}),r.details?Object(N.jsx)(ge,{query:d,onClose:l,figureId:r.details}):null]})},Te=f.a.div(J||(J=Object(d.a)(["\n  width: 100%;\n  height: 100vh;\n  position: relative;\n"]))),Ee=function(e){return Object(N.jsx)(Fe,{})};l.a.render(Object(N.jsx)(u.a.StrictMode,{children:Object(N.jsx)(Ee,{})}),document.getElementById("root")),a()}},[[50,1,2]]]);
//# sourceMappingURL=main.5570a9c0.chunk.js.map